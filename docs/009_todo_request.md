# 009: Todo依頼機能

## 概要
他のユーザーにTodoを依頼し、承認/拒否のフローを管理する機能

## 目的
- タスクの委託・依頼機能
- コラボレーションの促進
- 依頼フローの管理

## タスク

### データベース設計
- [ ] TodoRequestsテーブルの作成
- [ ] 依頼ステータスの管理（pending/accepted/rejected）
- [ ] RLSポリシーの設定
- [ ] インデックスの設定

### バックエンド実装
- [ ] TodoRequestモデルの作成
- [ ] ユーザー検索API（GET /api/users/search）
- [ ] Todo依頼送信API（POST /api/todos/{id}/request）
- [ ] 依頼受信一覧API（GET /api/requests/received）
- [ ] 依頼送信一覧API（GET /api/requests/sent）
- [ ] 依頼承認API（POST /api/requests/{id}/accept）
- [ ] 依頼拒否API（POST /api/requests/{id}/reject）
- [ ] 依頼取り消しAPI（DELETE /api/requests/{id}）
- [ ] 承認時のTodoコピー処理
- [ ] 依頼者の進捗参照権限

### フロントエンド実装
- [ ] 依頼送信ボタンコンポーネント
- [ ] ユーザー検索コンポーネント
- [ ] 依頼メッセージ入力フォーム
- [ ] 依頼送信モーダル
- [ ] 依頼受信一覧ページ
- [ ] 依頼送信一覧ページ
- [ ] 依頼詳細モーダル
- [ ] 承認/拒否ボタン
- [ ] 拒否理由入力フィールド

### 依頼フロー
- [ ] 依頼送信時のバリデーション
- [ ] 重複依頼の防止
- [ ] 依頼ステータスの管理
- [ ] 承認後のTodoのコピー処理
- [ ] 依頼者の進捗確認機能
- [ ] 依頼逃建期限の管理

### 通知連携
- [ ] 依頼受信通知の生成
- [ ] 承認/拒否通知の生成
- [ ] 依頼タスク完了通知
- [ ] リマインダー通知

### UI/UX
- [ ] 依頼ステータスアイコン
- [ ] 依頼フローの視覚的ガイダンス
- [ ] バッジ通知（未読件数）
- [ ] 依頼一覧のフィルター機能
- [ ] 依頼履歴の表示

### セキュリティ・バリデーション
- [ ] 依頼先ユーザーの存在確認
- [ ] 自分自身への依頼防止
- [ ] 依頼メッセージのサニタイジング
- [ ] スパム依頼防止機能
- [ ] 依頼数の制限（1日あたり）

### テスト
- [ ] 依頼送信テスト
- [ ] 承認/拒否テスト
- [ ] Todoコピー処理テスト
- [ ] 通知生成テスト
- [ ] 権限チェックテスト

## 完了条件
- [ ] 他のユーザーにTodoを依頼できる
- [ ] 依頼を承認/拒否できる
- [ ] 承認されたTodoが依頼先のTodoリストに追加される
- [ ] 依頼者が進捗を確認できる
- [ ] 依頼関連の通知が正しく送信される

## 技術詳細
- ユーザー検索: 部分一致検索、あいまい検索
- 通知システム: アプリ内通知
- ステータス管理: Enum型

## 推定工数
3日

## 依存関係
- 002_authentication.mdが完了していること
- 003_todo_crud.mdが完了していること
- 010_notifications.mdが完了していること

## 備考
- 依頼タスクは完全にコピーされる（独立したタスク）
- 依頼者は進捗を閲覧できるが編集はできない
- グループ依頼機能はMVP後に検討